
var chart_TestcaseFailureReport;
$(document).ready(function() {
	var colors = Highcharts.getOptions().colors;
	var name = 'TestAgents';
	var url = 'https://tfsb.abb.com/tfs/RobotProducts/Paint/';
	var categories = ['Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Assert. Error','Initial Error','Assert. Error','Assert. Error'];
	var data = [{ data: [{ color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100000'], data: { data: [{ dataLabels: '125705;100000', id: 125169, name: 'Prepare test machine', y: 125169 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100104'], data: { data: [{ dataLabels: '125705;100104', id: 179408, name: 'ACU with FOSI test', y: 179408 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100033'], data: { data: [{ dataLabels: '125705;100033', id: 175400, name: 'Test of MCENGINE device functions', y: 175400 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100036'], data: { data: [{ dataLabels: '125705;100036', id: 198620, name: 'Test of LCM functions', y: 198620 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100054'], data: { data: [{ dataLabels: '125705;100054', id: 132912, name: 'Test of PULSEMIXER Device functions', y: 132912 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100010'], data: { data: [{ dataLabels: '125705;100010', id: 177052, name: 'Test of CTM devices', y: 177052 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100022'], data: { data: [{ dataLabels: '125705;100022', id: 112482, name: 'Test of Limit Alarm functions', y: 112482 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100056'], data: { data: [{ dataLabels: '125705;100056', id: 114747, name: 'Test of VARIABLEDEVICE functions', y: 114747 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100011'], data: { data: [{ dataLabels: '125705;100011', id: 112492, name: 'Test of VENTURISENSOR device functions', y: 112492 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100048'], data: { data: [{ dataLabels: '125705;100048', id: 168938, name: 'Test of ELOGCATCHER device function', y: 168938 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100025'], data: { data: [{ dataLabels: '125705;100025', id: 183937, name: 'Test of LINEARCURVE scaling functions', y: 183937 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100049'], data: { data: [{ dataLabels: '125705;100049', id: 120272, name: 'Test of PWM device functions', y: 120272 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100053'], data: { data: [{ dataLabels: '125705;100053', id: 112464, name: 'Test of Brush device functions', y: 112464 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100044'], data: { data: [{ dataLabels: '125705;100044', id: 112473, name: 'Test of Bell regulator device functions', y: 112473 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100017'], data: { data: [{ dataLabels: '125705;100017', id: 112486, name: 'Test of REGULATOR device functions', y: 112486 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100077'], data: { data: [{ dataLabels: '125705;100077', id: 115312, name: 'HVC possible configs test', y: 115312 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100107'], data: { data: [{ dataLabels: '125705;100107', id: 185712, name: 'PIB FirmWare test', y: 185712 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100109'], data: { data: [{ dataLabels: '125705;100109', id: 137645, name: 'Check ici.py buildname', y: 137645 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100110'], data: { data: [{ dataLabels: '125705;100110', id: 137548, name: 'Check ICI dll buildname', y: 137548 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125706', '100001'], data: { data: [{ dataLabels: '125706;100001', id: 155609, name: 'SysTestShowcase', y: 155609 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125706', '100002'], data: { data: [{ dataLabels: '125706;100002', id: 120375, name: 'SysTestCfgBasic', y: 120375 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125706', '100015'], data: { data: [{ dataLabels: '125706;100015', id: 150612, name: 'SysTestValves', y: 150612 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125706', '100020'], data: { data: [{ dataLabels: '125706;100020', id: 149883, name: 'SysTestiDrive', y: 149883 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125706', '100021'], data: { data: [{ dataLabels: '125706;100021', id: 149886, name: 'SysTestACU', y: 149886 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125708', '100011'], data: { data: [{ dataLabels: '125708;100011', id: 219893, name: 'SysTestTrig--Trig Error on Ch3', y: 219893 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125707', '100005'], data: { data: [{ dataLabels: '125707;100005', id: 244760, name: 'Dispense Rack Test: iDrives and Motors', y: 244760 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125707', '100003'], data: { data: [{ dataLabels: '125707;100003', id: 244890, name: 'Dispense Rack Test: basic test with complex configuration', y: 244890 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Initial Error', categories: ['125707', '100000'], data: { data: [{ dataLabels: '125707;100000', id: 244508, name: 'Dispense Rack Test: Pump Interface Modules (PIM)', y: 244508 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125707', '100004'], data: { data: [{ dataLabels: '125707;100004', id: 246422, name: 'Dispense Rack Test: Basic CSV file reading test', y: 246422 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125707', '100002'], data: { data: [{ dataLabels: '125707;100002', id: 244759, name: 'Dispense Rack Test: Dispenser Interface Box (DIB)', y: 244759 }] }, color: 'firebrick' } }], name: 'Test Failure Series' }];
	chart_TestcaseFailureReport = new Highcharts.Chart({
		chart: { renderTo:'chart_TestcaseFailureReport_container', defaultSeriesType: 'column', zoomType: 'xy' }, 
		credits: { enabled: false }, 
		legend: { align: 'left', backgroundColor: '#FFFFFF', floating: true, layout: 'vertical', shadow: true, verticalAlign: 'bottom', x: 100, y: 70 }, 
		plotOptions: { column: { cursor: 'pointer', dataLabels: { color: 'black', enabled: true, formatter: function() { if(this.y != 167437) return this.y; else return this.point.id }, style: { fontWeight: 'bold' } }, point: { events: { click: ColumnPointClick } } } }, 
		title: { text: '' }, 
		tooltip: { formatter: function(){return this.point.name} }, 
		xAxis: { categories: ['Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'Assert.Error', 'InitialError', 'Assert.Error', 'Assert.Error'], title: { text: 'Reason for test case failure' } }, 
		yAxis: { min: 0, title: { text: 'No. of failures ' } }, 
		series: [{ data: [{ color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100000'], data: { data: [{ dataLabels: '125705;100000', id: 125169, name: 'Prepare test machine', y: 125169 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100104'], data: { data: [{ dataLabels: '125705;100104', id: 179408, name: 'ACU with FOSI test', y: 179408 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100033'], data: { data: [{ dataLabels: '125705;100033', id: 175400, name: 'Test of MCENGINE device functions', y: 175400 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100036'], data: { data: [{ dataLabels: '125705;100036', id: 198620, name: 'Test of LCM functions', y: 198620 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100054'], data: { data: [{ dataLabels: '125705;100054', id: 132912, name: 'Test of PULSEMIXER Device functions', y: 132912 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100010'], data: { data: [{ dataLabels: '125705;100010', id: 177052, name: 'Test of CTM devices', y: 177052 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100022'], data: { data: [{ dataLabels: '125705;100022', id: 112482, name: 'Test of Limit Alarm functions', y: 112482 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100056'], data: { data: [{ dataLabels: '125705;100056', id: 114747, name: 'Test of VARIABLEDEVICE functions', y: 114747 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100011'], data: { data: [{ dataLabels: '125705;100011', id: 112492, name: 'Test of VENTURISENSOR device functions', y: 112492 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100048'], data: { data: [{ dataLabels: '125705;100048', id: 168938, name: 'Test of ELOGCATCHER device function', y: 168938 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100025'], data: { data: [{ dataLabels: '125705;100025', id: 183937, name: 'Test of LINEARCURVE scaling functions', y: 183937 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100049'], data: { data: [{ dataLabels: '125705;100049', id: 120272, name: 'Test of PWM device functions', y: 120272 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100053'], data: { data: [{ dataLabels: '125705;100053', id: 112464, name: 'Test of Brush device functions', y: 112464 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100044'], data: { data: [{ dataLabels: '125705;100044', id: 112473, name: 'Test of Bell regulator device functions', y: 112473 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100017'], data: { data: [{ dataLabels: '125705;100017', id: 112486, name: 'Test of REGULATOR device functions', y: 112486 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100077'], data: { data: [{ dataLabels: '125705;100077', id: 115312, name: 'HVC possible configs test', y: 115312 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100107'], data: { data: [{ dataLabels: '125705;100107', id: 185712, name: 'PIB FirmWare test', y: 185712 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100109'], data: { data: [{ dataLabels: '125705;100109', id: 137645, name: 'Check ici.py buildname', y: 137645 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125705', '100110'], data: { data: [{ dataLabels: '125705;100110', id: 137548, name: 'Check ICI dll buildname', y: 137548 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125706', '100001'], data: { data: [{ dataLabels: '125706;100001', id: 155609, name: 'SysTestShowcase', y: 155609 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125706', '100002'], data: { data: [{ dataLabels: '125706;100002', id: 120375, name: 'SysTestCfgBasic', y: 120375 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125706', '100015'], data: { data: [{ dataLabels: '125706;100015', id: 150612, name: 'SysTestValves', y: 150612 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125706', '100020'], data: { data: [{ dataLabels: '125706;100020', id: 149883, name: 'SysTestiDrive', y: 149883 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125706', '100021'], data: { data: [{ dataLabels: '125706;100021', id: 149886, name: 'SysTestACU', y: 149886 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125708', '100011'], data: { data: [{ dataLabels: '125708;100011', id: 219893, name: 'SysTestTrig--Trig Error on Ch3', y: 219893 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125707', '100005'], data: { data: [{ dataLabels: '125707;100005', id: 244760, name: 'Dispense Rack Test: iDrives and Motors', y: 244760 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125707', '100003'], data: { data: [{ dataLabels: '125707;100003', id: 244890, name: 'Dispense Rack Test: basic test with complex configuration', y: 244890 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Initial Error', categories: ['125707', '100000'], data: { data: [{ dataLabels: '125707;100000', id: 244508, name: 'Dispense Rack Test: Pump Interface Modules (PIM)', y: 244508 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125707', '100004'], data: { data: [{ dataLabels: '125707;100004', id: 246422, name: 'Dispense Rack Test: Basic CSV file reading test', y: 246422 }] }, color: 'firebrick' } }, { color: 'firebrick', y: 1, drilldown: { name: 'Assert. Error', categories: ['125707', '100002'], data: { data: [{ dataLabels: '125707;100002', id: 244759, name: 'Dispense Rack Test: Dispenser Interface Box (DIB)', y: 244759 }] }, color: 'firebrick' } }], name: 'Test Failure Series' }]
	});

	function TooltipFormatter(){
		var point = this.point, s = this.x +':<b>'+ this.y+'</b><br/>';
                  if (point.drilldown) {
                    s += 'Click to view '+ point.category;
                  } else {
                    s += 'Click to return';
                  }
                  return s;
	}

	function ColumnPointClick(){
		var drilldown = this.drilldown;
                  if (drilldown) { // drill down
                    setChart(drilldown.name, drilldown.categories, drilldown.data.data, drilldown.color);
                   var dvele = document.getElementById("dvBackButton_TestFailure");
                        if (dvele === null)
                            {
                                createBackButton();
                                document.getElementById("dvBackButton_TestFailure").style.display = "block"; document.getElementById("dvBackButton_TestFailure").style.textAlign = "center"}
                        else { document.getElementById("dvBackButton_TestFailure").style.display = "block"; document.getElementById("dvBackButton_TestFailure").style.textAlign = "center"}
                             }
                        else { //redirect to test case
                                 window.open(url+"_TestManagement/Runs?_a=resultSummary&runId="+ this.dataLabels.split(';')[0] +"&resultId="+ this.dataLabels.split(';')[1],'_blank');
                            }
	}

	function createBackButton(){
		var dv = document.createElement("div");
                dv.style.cssText = "text - align:center";
            dv.id = "dvBackButton_TestFailure";
            var btn = document.createElement("Button");
            btn.id = "backButton_TestFailure";
            var t = document.createTextNode("Click to Return");
            btn.appendChild(t);
            dv.appendChild(btn);
            document.getElementById("chart_TestcaseFailureReport_container").appendChild(dv);
            var ele = document.getElementById("backButton_TestFailure");
            ele.onclick = function(){
                chart_TestcaseFailureReport.series[0].remove();
                for(var i=0;i<data.length;i++){
					 chart_TestcaseFailureReport.addSeries({
                    name: data[i].name,
                    data: data[i].data,
                    color: data[i].color
                    });
				};
                chart_TestcaseFailureReport.xAxis[0].setCategories(categories);
                chart_TestcaseFailureReport.xAxis[0].update({labels:{enabled:true}});
                chart_TestcaseFailureReport.yAxis[0].update({labels:{enabled:true}});
                chart_TestcaseFailureReport.yAxis[0].axisTitle.attr({text:'No. of Testcases'});
                document.getElementById("dvBackButton_TestFailure").style.display = "none";
            }
            if (typeof(this.drilldown)!= "undefined")
{ document.getElementById("dvBackButton_TestFailure").style.display = "block"; document.getElementById("dvBackButton_TestFailure").style.textAlign = "center"}
else{ document.getElementById("dvBackButton_TestFailure").style.display = "none"; }
            
	}

	function setChart(name, categories, data, color){
		chart_TestcaseFailureReport.xAxis[0].setCategories(categories);
                   chart_TestcaseFailureReport.xAxis[0].axisTitle.attr({text:'Testcase Name'});
                    chart_TestcaseFailureReport.xAxis[0].update({labels:{enabled:false}});
                    chart_TestcaseFailureReport.yAxis[0].update({labels:{enabled:false}});
                    chart_TestcaseFailureReport.yAxis[0].axisTitle.attr({text:''});
                    chart_TestcaseFailureReport.xAxis[0].axisTitle.attr({text:'Failed TestCases'});
                  while (chart_TestcaseFailureReport.series.length>0)
				  chart_TestcaseFailureReport.series[0].remove();
                  chart_TestcaseFailureReport.addSeries({
                     name: name,
                     data: data,
                     color: color || 'white'
                  });
	}
});

